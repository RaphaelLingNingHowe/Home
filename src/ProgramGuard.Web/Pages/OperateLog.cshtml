@page
@using ProgramGuard.Data.Dtos.OperateLog
@model ProgramGuard.Web.Pages.Account.OperateLogModel

@{
    /* 讓查詢能顯示到最新的資訊 */
    DateTime _timeNow = DateTime.Now.AddMinutes(1);
}

@section Scripts {
    <script src="~/js/pages/operateLog.js"></script>
}

<div class="my-5">
    <div class="row gx-5">
        <div class="col-md-2">
            <div class="card shadow-sm">
                <div class="card-body">
                    <div class="mb-3">
                        <label for="startTime" class="form-label">起始時間</label>
                        @(Html.DevExtreme().DateBox()
                            .ID("startTime")
                            .DisplayFormat("yyyy/MM/dd HH:mm")
                            .Type(DateBoxType.DateTime)
                            .ShowClearButton(true)
                            .AdaptivityEnabled(true)
                            .Value(_timeNow.AddDays(-1))
                            )
                    </div>
                    <div class="mb-3">
                        <label for="endTime" class="form-label">結束時間</label>
                        @(Html.DevExtreme().DateBox()
                            .ID("endTime")
                            .DisplayFormat("yyyy/MM/dd HH:mm")
                            .Type(DateBoxType.DateTime)
                            .ShowClearButton(true)
                            .AdaptivityEnabled(true)
                            .Value(_timeNow)
                            )
                    </div>
                    <div class="mb-3">
                        @(Html.DevExtreme().Button()
                            .Text("查詢")
                            .Type(ButtonType.Success)
                            .Width("100%")
                            .OnClick("validateQuery")
                            )
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-10">
            <div id="gridContainer">
                @(
                    Html.DevExtreme().DataGrid<GetOperateLogDto>()
                    .ID("dataGrid")
                    .DataSource(o => o.RemoteController()
                    .LoadUrl("OperateLog?Handler=Data")
                    .Key("Id")
                    .LoadParams(new
                    {
                        StartTime = new JS("() => getDateBoxValue('startTime')"),
                        EndTime = new JS("() => getDateBoxValue('endTime')")
                    }))
                    .Columns(columns =>
                    {
                        columns.AddFor(m => m.Account).Caption("使用者");
                        columns.AddFor(m => m.Action).Caption("操作");
                        columns.AddFor(m => m.Timestamp).Caption("操作時間").Format("yyyy-MM-dd HH:mm:ss");
                        columns.AddFor(m => m.Comment).Caption("備註");
                    })
                    .ShowBorders(true)
                    .ColumnAutoWidth(true)
                    .Selection(o => o.Mode(SelectionMode.Single))
                    .NoDataText("沒有資料")
                    .HoverStateEnabled(true)
                    .FocusedRowEnabled(true)
                    .ColumnHidingEnabled(true)
                    .Paging(paging => paging.PageSize(15))
                    .Pager(pager =>
                    {
                        pager.Visible(true);
                        pager.DisplayMode(GridPagerDisplayMode.Full);
                        pager.ShowPageSizeSelector(true);
                        pager.AllowedPageSizes(new JS("[15, 30, 50, 100, 200]"));
                        pager.ShowInfo(true);
                        pager.ShowNavigationButtons(true);
                    })
                    )
            </div>
        </div>
    </div>
</div>
